<Window x:Class="GameCapturePlayer.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings" Height="520" Width="640"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None" ResizeMode="NoResize" ShowInTaskbar="False" Background="#1e1e1e"
        KeyDown="Window_KeyDown">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <!-- footer removed -->
        </Grid.RowDefinitions>

        <!-- Header with title and close button -->
        <Border Grid.Row="0" Background="#2a2a2a" Padding="12,8" MouseLeftButtonDown="Header_MouseLeftButtonDown">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Settings" Foreground="White" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
                <Button Grid.Column="1" x:Name="btnClose" Width="28" Height="24" Background="Transparent" BorderThickness="0" Click="BtnClose_Click" ToolTip="Close">
                    <TextBlock Text="âœ•" FontSize="14" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>
            </Grid>
        </Border>

        <!-- Content -->
        <TabControl Grid.Row="1">
            <TabItem Header="General">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="12">
                        <TextBlock Text="Devices" FontWeight="Bold"/>
                        <Grid Margin="0,6,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Video:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="cmbVideo" Grid.Column="1" Width="360" DisplayMemberPath="Name" SelectionChanged="CmbVideo_SelectionChanged"/>
                            <TextBlock Text="Audio:" Grid.Row="1" VerticalAlignment="Center" Margin="0,8,8,0"/>
                            <ComboBox x:Name="cmbAudio" Grid.Row="1" Grid.Column="1" Width="360" DisplayMemberPath="Name" Margin="0,8,0,0" SelectionChanged="CmbAudio_SelectionChanged"/>
                            <CheckBox x:Name="chkRememberDevices" Grid.Row="2" Grid.Column="1" Content="Automatically start streaming from these devices" Margin="0,8,0,0" Checked="ChkRememberDevices_Changed" Unchecked="ChkRememberDevices_Changed"/>
                        </Grid>

                        <Separator/>
                        <TextBlock Text="Video Format (applies immediately when changed)" FontWeight="Bold"/>
                        <StackPanel Margin="0,6,0,12" Orientation="Horizontal">
                            <TextBlock Text="Resolution:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <ComboBox x:Name="cmbFormats" Width="260" SelectionChanged="CmbFormats_SelectionChanged"/>
                        </StackPanel>

                        <Separator/>
                        <TextBlock Text="Stats Overlay" FontWeight="Bold"/>
                        <StackPanel Margin="0,6,0,0" Orientation="Horizontal">
                            <CheckBox x:Name="chkShowStats" Content="Show stats overlay" Margin="0,0,8,0" Checked="ChkShowStats_Changed" Unchecked="ChkShowStats_Changed"/>
                            <TextBlock Text="Position:" Margin="16,6,4,0"/>
                            <ComboBox x:Name="cmbStatsPos" Width="160" SelectionChanged="CmbStatsPos_SelectionChanged">
                                <ComboBoxItem Content="TopLeft"/>
                                <ComboBoxItem Content="TopRight"/>
                                <ComboBoxItem Content="BottomLeft"/>
                                <ComboBoxItem Content="BottomRight"/>
                            </ComboBox>
                        </StackPanel>
                        <TextBlock Foreground="Gray" FontSize="12" Margin="0,6,0,0" Text="Overlay renders inside the preview panel to avoid airspace issues."/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Advanced">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="12">
                        <TextBlock Text="System Tweaks (apply immediately while running)" FontWeight="Bold"/>
                        <StackPanel Margin="0,6,0,12">
                            <CheckBox x:Name="chkHighPrio" Content="High process priority" Margin="0,4,0,0" Checked="ChkHighPrio_Changed" Unchecked="ChkHighPrio_Changed"/>
                            <CheckBox x:Name="chkOneMsTimer" Content="1 ms system timer (timeBeginPeriod)" Margin="0,4,0,0" Checked="ChkOneMsTimer_Changed" Unchecked="ChkOneMsTimer_Changed"/>
                            <CheckBox x:Name="chkLowLatencyGC" Content=".NET SustainedLowLatency GC" Margin="0,4,0,0" Checked="ChkLowLatencyGC_Changed" Unchecked="ChkLowLatencyGC_Changed"/>
                            <CheckBox x:Name="chkPreventSleep" Content="Prevent system sleep while streaming" Margin="0,4,0,0" Checked="ChkPreventSleep_Changed" Unchecked="ChkPreventSleep_Changed"/>
                        </StackPanel>

                        <Separator/>
                        <TextBlock Text="Video Graph Tweaks (take effect on next Start)" FontWeight="Bold"/>
                        <StackPanel Margin="0,6,0,12">
                            <CheckBox x:Name="chkSingleStream" Content="VMR9 single stream" Margin="0,4,0,0" Checked="GraphTweaks_Changed" Unchecked="GraphTweaks_Changed"/>
                            <CheckBox x:Name="chkMinimalBuffering" Content="Minimal pin buffering (IAMBufferNegotiation)" Margin="0,4,0,0" Checked="GraphTweaks_Changed" Unchecked="GraphTweaks_Changed"/>
                            <CheckBox x:Name="chkNoGraphClock" Content="No graph clock (SetSyncSource null)" Margin="0,4,0,0" Checked="GraphTweaks_Changed" Unchecked="GraphTweaks_Changed"/>
                            <TextBlock Foreground="Gray" FontSize="12" Text="Tip: Stop and Start preview to apply these."/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Footer removed: saving happens automatically on close -->
    </Grid>
</Window>
